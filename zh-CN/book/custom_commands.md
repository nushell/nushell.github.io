# è‡ªå®šä¹‰å‘½ä»¤

Nu å…·å¤‡ç»„åˆé•¿ç®¡é“çš„èƒ½åŠ›ä½¿ä½ å¯¹æ•°æ®å’Œç³»ç»Ÿæœ‰å¾ˆå¼ºçš„æ§åˆ¶åŠ›ï¼Œä½†å®ƒçš„ä»£ä»·æ˜¯éœ€è¦å¤§é‡çš„é”®ç›˜è¾“å…¥ã€‚ä¸è¿‡ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä¿å­˜ç²¾å¿ƒè®¾è®¡çš„ç®¡é“ä»¥ä¾¿åå¤ä½¿ç”¨ã€‚

è¿™å°±æ˜¯è‡ªå®šä¹‰å‘½ä»¤(Custom Commands)çš„ä½œç”¨ã€‚

ä¸‹é¢çœ‹ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤çš„ä¾‹å­ï¼š

```bash
def greet [name] {
  echo "hello" $name
}
```

åœ¨è¿™ä¸ªå®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†`greet`å‘½ä»¤ï¼Œå®ƒéœ€è¦ä¸€ä¸ªå‚æ•°`name`ã€‚åœ¨è¿™ä¸ªå‚æ•°åé¢æ˜¯è‡ªå®šä¹‰å‘½ä»¤è¿è¡Œæ—¶å°†æ‰§è¡Œçš„ä»£ç å—ã€‚å½“è¢«è°ƒç”¨æ—¶ï¼Œè‡ªå®šä¹‰å‘½ä»¤å°†æŠŠä¼ é€’ç»™`name`çš„å€¼è®¾ç½®ä¸º`$name`å˜é‡ï¼Œè¯¥å˜é‡åœ¨å—å†…æ˜¯å¯ç”¨çš„ã€‚

è¦è¿è¡Œä¸Šè¿°å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨å†…ç½®å‘½ä»¤ä¸€æ ·è°ƒç”¨å®ƒï¼š

```bash
> greet "world"
```

å½“æˆ‘ä»¬è¿™æ ·åšçš„æ—¶å€™ï¼Œå°±ä¼šå¾—åˆ°è¾“å‡ºï¼Œå¦‚åŒæˆ‘ä»¬ä½¿ç”¨å†…ç½®å‘½ä»¤ä¸€æ ·ï¼š

```
â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€
 0 â”‚ hello
 1 â”‚ world
â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€
```

## å‘½ä»¤åç§°

åœ¨ Nushell ä¸­ï¼Œå‘½ä»¤åæ˜¯ä¸€ä¸²å­—ç¬¦æˆ–ä¸€ä¸ªå¸¦å¼•å·çš„å­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯ä¸€äº›æœ‰æ•ˆå‘½ä»¤åçš„ä¾‹å­ï¼š`greet`, `get-size`, `mycommand123`, `"mycommand"`, `ğŸ˜Š`, å’Œ`123`ã€‚

_æ³¨æ„ï¼šåœ¨ Nushell ä¸­ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ç”¨`-`æ¥åˆ†éš”å‘½ä»¤çš„å¤šä¸ªå•è¯ï¼Œä»¥æé«˜å¯è¯»æ€§ã€‚_ ä¾‹å¦‚ï¼Œä½¿ç”¨ `get-size` è€Œä¸æ˜¯ `getsize` æˆ–è€… `get_size`ã€‚

## å­å‘½ä»¤

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç©ºæ ¼æ¥å®šä¹‰å‘½ä»¤çš„å­å‘½ä»¤(Subcommand)ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™`str`æ·»åŠ ä¸€ä¸ªæ–°çš„å­å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡å‘½åæˆ‘ä»¬çš„å­å‘½ä»¤ä»¥ "str" å¼€å¤´æ¥åšåˆ°ã€‚æ¯”å¦‚ï¼š

```bash
def "str mycommand" [] {
  echo hello
}
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨`str`çš„å†…ç½®å­å‘½ä»¤ä¸€æ ·è°ƒç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰å‘½ä»¤ï¼š

```bash
> str mycommand
```

## å‚æ•°ç±»å‹

åœ¨å®šä¹‰è‡ªå®šä¹‰å‘½ä»¤æ—¶ï¼Œä½ å¯ä»¥ä¸ºæ¯ä¸ªå‚æ•°å‘½åå¹¶é€‰æ‹©æ€§åœ°è®¾ç½®å…¶ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŠŠä¸Šé¢çš„å†…å®¹å†™æˆï¼š

```bash
def greet [name: string] {
  echo "hello" $name
}
```

å‚æ•°çš„ç±»å‹æ˜¯å¯é€‰çš„ã€‚Nushell æ”¯æŒä¸æ·»åŠ ç±»å‹ï¼Œæ­¤æ—¶ä¼šæŠŠå‚æ•°ç±»å‹å½“ä½œ`any`ã€‚å¦‚æœä½ åœ¨å‚æ•°ä¸Šæ ‡æ³¨äº†ä¸€ä¸ªç±»å‹ï¼ŒNushell å°†åœ¨ä½ è°ƒç”¨å‡½æ•°çš„æ—¶å€™æ£€æŸ¥è¯¥ç±»å‹ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä½ éœ€è¦è¾“å…¥ä¸€ä¸ª`int`ç±»å‹ï¼š

```bash
def greet [name: int] {
  echo "hello" $name
}

greet world
```

å¦‚æœæˆ‘ä»¬å°è¯•è¿è¡Œä¸Šè¿°å†…å®¹ï¼ŒNushell ä¼šå‘Šè¯‰æˆ‘ä»¬ï¼Œç±»å‹ä¸åŒ¹é…ï¼š

```
error: Type Error
  â”Œâ”€ shell:6:7
  â”‚
5 â”‚ greet world
  â”‚       ^^^^^ Expected int, found world
```

è¿™å¯ä»¥å¸®åŠ©æŒ‡å¯¼ä½ çš„ç”¨æˆ·åªä½¿ç”¨æ”¯æŒçš„ç±»å‹æ¥è°ƒç”¨ä½ æ‰€å®šä¹‰çš„å‘½ä»¤ã€‚

ç›®å‰å¯ä»¥æ”¯æŒçš„ç±»å‹æ˜¯ï¼ˆä» 0.59.0 ç‰ˆæœ¬å¼€å§‹ï¼‰ï¼š

- `any`
- `block`
- `cell-path`
- `duration`
- `path`
- `expr`
- `filesize`
- `glob`
- `int`
- `math`
- `number`
- `operator`
- `range`
- `cond`
- `bool`
- `signature`
- `string`
- `variable`

## å¯é€‰ä½ç½®å‚æ•°

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ç½®å‚æ•°(Positional Parameters)æ˜¯å¿…é¡»çš„ã€‚å¦‚æœæ²¡æœ‰ä¼ é€’ä½ç½®å‚æ•°ï¼Œæˆ‘ä»¬å°†é‡åˆ°ä¸€ä¸ªæŠ¥é”™ï¼š

```
  Ã— Missing required positional argument.
   â•­â”€[entry #23:1:1]
 1 â”‚ greet
   Â·      â–²
   Â·      â•°â”€â”€ missing name
   â•°â”€â”€â”€â”€
  help: Usage: greet <name>
```

æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªä½ç½®å‚æ•°çš„åå­—åé¢åŠ ä¸Šä¸€ä¸ªé—®å·ï¼ˆ`?`ï¼‰ï¼Œå°†å…¶æ ‡è®°ä¸ºå¯é€‰å‚æ•°ã€‚æ¯”å¦‚ï¼š

```bash
def greet [name?: string] {
  echo "hello" $name
}

greet
```

ä½¿ä¸€ä¸ªä½ç½®å‚æ•°æˆä¸ºå¯é€‰å‚æ•°å¹¶ä¸æ”¹å˜å®ƒåœ¨å‘½ä»¤ä½“ä¸­è¢«è®¿é—®çš„åç§°ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå°½ç®¡å‚æ•°åˆ—è¡¨ä¸­æœ‰`?`çš„åç¼€ï¼Œä½†å®ƒä»ç„¶ä»¥`$name`çš„å½¢å¼è¢«è®¿é—®ã€‚

å½“ä¸€ä¸ªå¯é€‰å‚æ•°æ²¡æœ‰è¢«ä¼ é€’ï¼Œå®ƒåœ¨å‘½ä»¤ä½“ä¸­çš„å€¼ç­‰äº`null`å’Œ`$nothing`ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å¯¹æ²¡æœ‰ä¼ é€’å‚æ•°çš„æƒ…å†µè¿›è¡Œå¤„ç†ï¼š

```bash
def greet [name?: string] {
  if ($name == null) {
    echo "hello, I don't know your name!"
  } else {
    echo "hello" $name
  }
}

greet
```

å¦‚æœå¿…éœ€çš„å’Œå¯é€‰çš„ä½ç½®å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆå¿…éœ€çš„å‚æ•°å¿…é¡»å…ˆå‡ºç°åœ¨å®šä¹‰ä¸­ã€‚

## æ ‡å¿—

é™¤äº†ä¼ é€’ä½ç½®å‚æ•°ä¹‹å¤–, ä½ è¿˜å¯ä»¥é€šè¿‡ä¸ºè‡ªå®šä¹‰å‘½ä»¤å®šä¹‰æ ‡å¿—(Flags)æ¥ä¼ é€’å‘½åå‚æ•°ã€‚

æ¯”å¦‚ï¼š

```bash
def greet [
  name: string
  --age: int
] {
  echo $name $age
}
```

åœ¨ä¸Šé¢çš„`greet`å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†`name`ä½ç½®å‚æ•°ä»¥åŠ`age`æ ‡å¿—ã€‚è¿™å…è®¸`greet`çš„è°ƒç”¨è€…ä¹Ÿå¯ä»¥é€‰æ‹©ä¼ é€’`age`å‚æ•°ã€‚

ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è°ƒç”¨ä¸Šè¿°å†…å®¹ï¼š

```bash
> greet world --age 10
```

æˆ–è€…ï¼š

```bash
> greet --age 10 world
```

æˆ–è€…ç”šè‡³å®Œå…¨ä¸ä½¿ç”¨æ ‡å¿—ï¼š

```
> greet world
```

æ ‡å¿—ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼©å†™ç‰ˆæœ¬ï¼Œè¿™å…è®¸ä½ ä¼ é€’ä¸€ä¸ªæ›´ç®€å•çš„æ ‡å¿—ï¼Œå¦‚åŒä¼ é€’ä¸€ä¸ªæ›´å®¹æ˜“é˜…è¯»çš„å…¨å†™æ ‡å¿—é‚£æ ·ã€‚

è®©æˆ‘ä»¬æ‰©å±•å‰é¢çš„ä¾‹å­ï¼Œä¸º`age`æ·»åŠ ä¸€ä¸ªç¼©å†™æ ‡å¿—ï¼š

```bash
def greet [
  name: string
  --age (-a): int
] {
  echo $name $age
}
```

_æ³¨æ„ï¼š_ æ ‡å¿—æ˜¯ä»¥å…¶å…¨ç§°å‘½åçš„ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¾‹å­çš„å‘½ä»¤ä½“å†…éœ€è¦ä½¿ç”¨`$age`è€Œä¸æ˜¯`$a`ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¼©å†™æ ‡å¿—æ¥è°ƒç”¨è¿™ä¸ªæ–°çš„å®šä¹‰ï¼š

```
> greet -a 10 hello
```

## å‰©ä½™å‚æ•°

åœ¨æŸäº›æƒ…å†µä¸‹, ä½ å¯èƒ½æƒ³å®šä¹‰ä¸€ä¸ªéœ€è¦ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°çš„å‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‰©ä½™å‚æ•°(Rest Parameter)æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œé€šè¿‡ä¸‹é¢çš„`...`è¯­æ³•ï¼š

```bash
def greet [...name: string] {
  echo "hello all:"
  for $n in $name {
    echo $n
  }
}

greet earth mars jupiter venus
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡çš„å‚æ•°æ¥è°ƒç”¨ä¸Šè¿°`greet`å‘½ä»¤çš„å®šä¹‰ï¼ŒåŒ…æ‹¬å®Œå…¨æ²¡æœ‰å‚æ•°ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½å°†è¢«æ”¶é›†åˆ°`$name`åˆ—è¡¨ä¸­ã€‚

å‰©ä½™å‚æ•°å¯ä»¥å’Œä½ç½®å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼š

```bash
def greet [vip: string, ...name: string] {
  echo "hello to our VIP" $vip
  echo "and hello to everybody else:"
  for $n in $name {
    echo $n
  }
}

#     $vip          $name
#     ---- ------------------------
greet moon earth mars jupiter venus
```

## ä¸ºå‘½ä»¤æ·»åŠ æ–‡æ¡£

ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©ç”¨æˆ·ä½¿ç”¨ä½ çš„è‡ªå®šä¹‰å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä¸ºå…¶æ·»åŠ é¢å¤–çš„å‘½ä»¤å’Œå‚æ•°æè¿°ã€‚

ä»¥æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ä¸ºä¾‹ï¼š

```bash
def greet [
  name: string
  --age (-a): int
] {
  echo $name $age
}
```

ä¸€æ—¦å®šä¹‰å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ`help greet`æ¥è·å¾—è¯¥å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼š

```
Usage:
  > greet <name> {flags}

Parameters:
  <name>

Flags:
  -h, --help: Display this help message
  -a, --age <integer>
```

ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®šä¹‰çš„å‚æ•°å’Œæ ‡å¿—ï¼Œä»¥åŠæ‰€æœ‰å‘½ä»¤éƒ½ä¼šå¾—åˆ°çš„`-h`å¸®åŠ©æ ‡å¿—ã€‚

ä¸ºäº†æ”¹è¿›è¿™ä¸ªå¸®åŠ©ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰ä¸­åŠ å…¥æè¿°ï¼Œè¿™äº›æè¿°å°†åœ¨å¸®åŠ©ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼š

```bash
# A greeting command that can greet the caller
def greet [
  name: string      # The name of the person to greet
  --age (-a): int   # The age of the person
] {
  echo $name $age
}
```

æˆ‘ä»¬ç»™å®šä¹‰å’Œå‚æ•°æ·»åŠ çš„æ³¨é‡Šä¼šä½œä¸ºæè¿°å‡ºç°åœ¨å‘½ä»¤çš„`help`ä¸­ã€‚

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œ`help greet`ï¼Œå°±ä¼šå¾—åˆ°ä¸€äº›æ›´å‹å¥½çš„å¸®åŠ©æ–‡æœ¬ï¼š

```
A greeting command that can greet the caller

Usage:
  > greet <name> {flags}

Parameters:
  <name> The name of the person to greet

Flags:
  -h, --help: Display this help message
  -a, --age <integer>: The age of the person
```

## ç®¡é“è¾“å‡º

è‡ªå®šä¹‰å‘½ä»¤ä¼šåƒå†…ç½®å‘½ä»¤ä¸€æ ·æµå¼è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³é‡æ„è¿™ä¸ªç®¡é“ï¼š

```bash
> ls | get name
```

è®©æˆ‘ä»¬æŠŠ[`ls`](/book/commands/ls.md)ç§»åˆ°æˆ‘ä»¬ç¼–å†™çš„å‘½ä»¤ä¸­ï¼š

```bash
def my-ls [] { ls }
```

æˆ‘ä»¬å°±å¯ä»¥åƒä½¿ç”¨[`ls`](/book/commands/ls.md)ä¸€æ ·ä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼š

```
> my-ls | get name
â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 0 â”‚ myscript.nu
 1 â”‚ myscript2.nu
 2 â”‚ welcome_to_nushell.md
â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

è¿™è®©æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤å¹¶å¤„ç†å®ƒä»¬çš„è¾“å‡ºã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä¸åƒå…¶ä»–è¯­è¨€é‚£æ ·ä½¿ç”¨è¿”å›è¯­å¥ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æˆ‘ä»¬åˆ›å»ºç®¡é“ï¼Œè€Œå…¶è¾“å‡ºæ•°æ®æµå¯ä»¥è¿æ¥åˆ°å…¶ä»–ç®¡é“ã€‚

## ç®¡é“è¾“å…¥

å¦‚åŒå…¶ä»–å‘½ä»¤ä¸€æ ·ï¼Œè‡ªå®šä¹‰å‘½ä»¤ä¹Ÿå¯ä»¥ä»ç®¡é“ä¸­è·å–è¾“å…¥ï¼Œè¿™ä¸ªè¾“å…¥ä¼šè‡ªåŠ¨ä¼ é€’ç»™è‡ªå®šä¹‰å‘½ä»¤æ‰€ä½¿ç”¨çš„ä»£ç å—ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŠŠæ‰€æœ‰æ¥æ”¶å€¼éƒ½åŠ å€çš„å‘½ä»¤ï¼š

```bash
def double [] {
  each { |it| 2 * $it }
}
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªç®¡é“ä¸­è°ƒç”¨ä¸Šè¿°å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°å®ƒå¯¹è¾“å…¥çš„å¤„ç†ç»“æœï¼š

```
> [1 2 3] | double
â”€â”€â”€â”¬â”€â”€â”€â”€â”€
 0 â”‚ 2
 1 â”‚ 4
 2 â”‚ 6
â”€â”€â”€â”´â”€â”€â”€â”€â”€
```

## æŒä¹…åŒ–

å…³äºå¦‚ä½•æŒä¹…åŒ–è‡ªå®šä¹‰å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨ä½ å¯åŠ¨ Nushell æ—¶å®ƒä»¬æ˜¯å¯ç”¨çš„ï¼Œè¯·å‚é˜… [é…ç½®](configuration.md) éƒ¨åˆ†å¹¶æ·»åŠ ä½ çš„å¯åŠ¨è„šæœ¬ã€‚
